<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="marginaleffects">
<title>Bayesian analysis with brms • marginaleffects</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian analysis with brms">
<meta property="og:description" content="marginaleffects">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">marginaleffects</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.8.1.9125</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/marginaleffects.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vincentarelbundock/marginaleffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bayesian analysis with brms</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vincentarelbundock/marginaleffects/blob/HEAD/vignettes/brms.Rmd" class="external-link"><code>vignettes/brms.Rmd</code></a></small>
      <div class="d-none name"><code>brms.Rmd</code></div>
    </div>

    
    
<p>The <code>marginaleffects</code> package offers convenience functions
to compute and display predictions, contrasts, and marginal effects from
bayesian models estimated by the <code>brms</code> package. To compute
these quantities, <code>marginaleffects</code> relies on workhorse
functions from the <code>brms</code> package to draw from the posterior
distribution. The type of draws used is controlled by using the
<code>type</code> argument of the <code>predictions</code> or
<code>slopes</code> functions:</p>
<ul>
<li>
<code>type = "response"</code>: Compute posterior draws of the
expected value using the <code><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">brms::posterior_epred</a></code>
function.</li>
<li>
<code>type = "link"</code>: Compute posterior draws of the linear
predictor using the <code><a href="https://mc-stan.org/rstantools/reference/posterior_linpred.html" class="external-link">brms::posterior_linpred</a></code> function.</li>
<li>
<code>type = "prediction"</code>: Compute posterior draws of the
posterior predictive distribution using the
<code><a href="https://mc-stan.org/rstantools/reference/posterior_predict.html" class="external-link">brms::posterior_predict</a></code> function.</li>
</ul>
<p>The <code>predictions</code> and <code>slopes</code> functions can
also pass additional arguments to the <code>brms</code> prediction
functions via the <code>...</code> ellipsis. For example, if
<code>mod</code> is a mixed-effects model, then this command will
compute 10 draws from the posterior predictive distribution, while
ignoring all group-level effects:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"prediction"</span>, ndraws <span class="op">=</span> <span class="fl">10</span>, re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>See the <code>brms</code> documentation for a list of available
arguments:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="fu">brms</span><span class="fu">::</span><span class="va"><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">posterior_epred</a></span></span>
<span><span class="op">?</span><span class="fu">brms</span><span class="fu">::</span><span class="va"><a href="https://mc-stan.org/rstantools/reference/posterior_linpred.html" class="external-link">posterior_linpred</a></span></span>
<span><span class="op">?</span><span class="fu">brms</span><span class="fu">::</span><span class="va"><a href="https://mc-stan.org/rstantools/reference/posterior_predict.html" class="external-link">posterior_predict</a></span></span></code></pre></div>
<div class="section level2">
<h2 id="logistic-regression-with-multiplicative-interactions">Logistic regression with multiplicative interactions<a class="anchor" aria-label="anchor" href="#logistic-regression-with-multiplicative-interactions"></a>
</h2>
<p>Load libraries and download data on passengers of the Titanic from <a href="https://vincentarelbundock.github.io/Rdatasets/" class="external-link">the Rdatasets
archive:</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/carData/TitanicSurvival.csv"</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">survived</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">survived</span> <span class="op">==</span> <span class="st">"yes"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">woman</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Fit a logit model with a multiplicative interaction:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">survived</span> <span class="op">~</span> <span class="va">woman</span> <span class="op">*</span> <span class="va">age</span> <span class="op">+</span> <span class="va">passengerClass</span>,</span>
<span>           family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">bernoulli</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>           data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="adjusted-predictions">Adjusted predictions<a class="anchor" aria-label="anchor" href="#adjusted-predictions"></a>
</h3>
<p>We can compute <a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html">adjusted
predicted values</a> of the outcome variable (i.e., probability of
survival aboard the Titanic) using the <code>predictions</code>
function. By default, this function calculates predictions for each row
of the dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    0.9367 0.9070 0.9590</span></span>
<span><span class="co">#&gt;    0.8493 0.7453 0.9187</span></span>
<span><span class="co">#&gt;    0.9433 0.8949 0.9704</span></span>
<span><span class="co">#&gt;    0.5131 0.4302 0.6000</span></span>
<span><span class="co">#&gt;    0.9375 0.9080 0.9601</span></span>
<span><span class="co">#&gt;    0.2731 0.2029 0.3518</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, survived, woman, age, passengerClass</span></span></code></pre></div>
<p>To visualize the relationship between the outcome and one of the
regressors, we can plot conditional adjusted predictions with the
<code>plot_predictions</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>Compute adjusted predictions for some user-specified values of the
regressors, using the <code>newdata</code> argument and the
<code>datagrid</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>woman <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>                                       passengerClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1st"</span>, <span class="st">"2nd"</span>, <span class="st">"3rd"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate   2.5 % 97.5 % woman passengerClass</span></span>
<span><span class="co">#&gt;    0.5149 0.43192 0.6019     0            1st</span></span>
<span><span class="co">#&gt;    0.2013 0.15362 0.2613     0            2nd</span></span>
<span><span class="co">#&gt;    0.0875 0.06556 0.1141     0            3rd</span></span>
<span><span class="co">#&gt;    0.9364 0.90661 0.9588     1            1st</span></span>
<span><span class="co">#&gt;    0.7783 0.70897 0.8346     1            2nd</span></span>
<span><span class="co">#&gt;    0.5701 0.49378 0.6442     1            3rd</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, survived, age, woman, passengerClass</span></span></code></pre></div>
<p>The <code>posterior_draws</code> function samples from the posterior
distribution of the model, and produces a data frame with
<code>drawid</code> and <code>draw</code> columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt;   drawid       draw rowid     type   estimate   conf.low conf.high  survived      age woman passengerClass</span></span>
<span><span class="co">#&gt; 1      1 0.46566713     1 response 0.51492993 0.43192231 0.6018749 0.4082218 29.88113     0            1st</span></span>
<span><span class="co">#&gt; 2      1 0.16658900     2 response 0.20128833 0.15362308 0.2613351 0.4082218 29.88113     0            2nd</span></span>
<span><span class="co">#&gt; 3      1 0.08750961     3 response 0.08750369 0.06555724 0.1141134 0.4082218 29.88113     0            3rd</span></span>
<span><span class="co">#&gt; 4      1 0.93735755     4 response 0.93641346 0.90660921 0.9587589 0.4082218 29.88113     1            1st</span></span>
<span><span class="co">#&gt; 5      1 0.77437334     5 response 0.77829290 0.70896643 0.8346419 0.4082218 29.88113     1            2nd</span></span>
<span><span class="co">#&gt; 6      1 0.62216334     6 response 0.57010265 0.49377997 0.6441967 0.4082218 29.88113     1            3rd</span></span></code></pre></div>
<p>This “long” format makes it easy to plots results:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">woman</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span> <span class="va">passengerClass</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted probability of survival"</span>, y <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="st">"Woman"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="marginal-effects">Marginal effects<a class="anchor" aria-label="anchor" href="#marginal-effects"></a>
</h3>
<p>Use <code><a href="../reference/slopes.html">slopes()</a></code> to <a href="https://vincentarelbundock.github.io/marginaleffects/articles/slopes.html">compute
marginal effects (slopes of the regression equation)</a> for each row of
the dataset, and use <code>)</code> to compute “Average Marginal
Effects”, that is, the average of all observation-level marginal
effects:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="va">mfx</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Term Contrast   Estimate      2.5 %     97.5 %</span></span>
<span><span class="co">#&gt;  woman    dY/dX  0.1529810  0.1088301  0.2051898</span></span>
<span><span class="co">#&gt;  woman    dY/dX  0.1354646  0.0360765  0.2970409</span></span>
<span><span class="co">#&gt;  woman    dY/dX  0.0587891  0.0287561  0.1009453</span></span>
<span><span class="co">#&gt;  woman    dY/dX  0.6545371  0.5669930  0.7442501</span></span>
<span><span class="co">#&gt;  woman    dY/dX  0.1382874  0.0972243  0.1863969</span></span>
<span><span class="co">#&gt; --- 4174 rows omitted. See ?avg_slopes and ?print.marginaleffects --- </span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.2642843 -0.3397125 -0.1986620</span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.3527451 -0.4262574 -0.2823186</span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.4593140 -0.5506994 -0.3695048</span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.4549515 -0.5463443 -0.3652652</span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.4364994 -0.5260837 -0.3497621 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo, survived, woman, age, passengerClass, eps</span></span></code></pre></div>
<p>Compute marginal effects with some regressors fixed at user-specified
values, and other regressors held at their means:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span></span>
<span>        woman <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        passengerClass <span class="op">=</span> <span class="st">"1st"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            Term  Contrast   Estimate     2.5 %    97.5 % woman passengerClass</span></span>
<span><span class="co">#&gt;           woman     dY/dX  0.1562784  0.111359  0.208756     1            1st</span></span>
<span><span class="co">#&gt;             age     dY/dX -0.0002383 -0.001355  0.000871     1            1st</span></span>
<span><span class="co">#&gt;  passengerClass 2nd - 1st -0.1574416 -0.223275 -0.102890     1            1st</span></span>
<span><span class="co">#&gt;  passengerClass 3rd - 1st -0.3653764 -0.438319 -0.294769     1            1st</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo, survived, age, woman, passengerClass, eps</span></span></code></pre></div>
<p>Compute and plot conditional marginal effects:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>, effect <span class="op">=</span> <span class="st">"woman"</span>, condition <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
<p>The <code>posterior_draws</code> produces a dataset with
<code>drawid</code> and <code>draw</code> columns:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 16736000       17</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span>
<span><span class="co">#&gt;   drawid      draw rowid     type  term contrast   estimate   conf.low conf.high predicted predicted_hi predicted_lo survived woman     age passengerClass   eps</span></span>
<span><span class="co">#&gt; 1      1 0.1633609     1 response woman    dY/dX 0.15298096 0.10883007 0.2051898 0.9366604    0.9366751    0.9366604        1     1 29.0000            1st 1e-04</span></span>
<span><span class="co">#&gt; 2      1 0.1359009     2 response woman    dY/dX 0.13546458 0.03607654 0.2970409 0.8493050    0.8493174    0.8493050        1     0  0.9167            1st 1e-04</span></span>
<span><span class="co">#&gt; 3      1 0.0615405     3 response woman    dY/dX 0.05878909 0.02875607 0.1009453 0.9433293    0.9433358    0.9433293        0     1  2.0000            1st 1e-04</span></span>
<span><span class="co">#&gt; 4      1 0.7088821     4 response woman    dY/dX 0.65453708 0.56699300 0.7442501 0.5131011    0.5131652    0.5131011        0     0 30.0000            1st 1e-04</span></span>
<span><span class="co">#&gt; 5      1 0.1473759     5 response woman    dY/dX 0.13828737 0.09722433 0.1863969 0.9374937    0.9375085    0.9374937        0     1 25.0000            1st 1e-04</span></span>
<span><span class="co">#&gt; 6      1 0.6635099     6 response woman    dY/dX 0.70740470 0.58935737 0.8406470 0.2730542    0.2731252    0.2730542        1     0 48.0000            1st 1e-04</span></span></code></pre></div>
<p>We can use this dataset to plot our results. For example, to plot the
posterior density of the marginal effect of <code>age</code> when the
<code>woman</code> variable is equal to 0 or 1:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>woman <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">woman</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marginal Effect of Age on Survival"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Woman"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-16-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="random-effects-model">Random effects model<a class="anchor" aria-label="anchor" href="#random-effects-model"></a>
</h2>
<p>This section replicates some of the analyses of a random effects
model published in Andrew Heiss’ blog post: <a href="https://www.andrewheiss.com/blog/2021/11/10/ame-bayes-re-guide" class="external-link">“A
guide to correctly calculating posterior predictions and average
marginal effects with multilevel Bayesian models.”</a> The objective is
mainly to illustrate the use of <code>marginaleffects</code>. Please
refer to the original post for a detailed discussion of the quantities
computed below.</p>
<p>Load libraries and download data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vdem_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://github.com/vincentarelbundock/marginaleffects/raw/main/data-raw/vdem_2015.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">)</span></span>
<span><span class="co">#&gt;   country_name country_text_id year                           region media_index party_autonomy_ord polyarchy civil_liberties party_autonomy</span></span>
<span><span class="co">#&gt; 1       Mexico             MEX 2015  Latin America and the Caribbean       0.837                  3     0.631           0.704           TRUE</span></span>
<span><span class="co">#&gt; 2     Suriname             SUR 2015  Latin America and the Caribbean       0.883                  4     0.777           0.887           TRUE</span></span>
<span><span class="co">#&gt; 3       Sweden             SWE 2015 Western Europe and North America       0.956                  4     0.915           0.968           TRUE</span></span>
<span><span class="co">#&gt; 4  Switzerland             CHE 2015 Western Europe and North America       0.939                  4     0.901           0.960           TRUE</span></span>
<span><span class="co">#&gt; 5        Ghana             GHA 2015               Sub-Saharan Africa       0.858                  4     0.724           0.921           TRUE</span></span>
<span><span class="co">#&gt; 6 South Africa             ZAF 2015               Sub-Saharan Africa       0.898                  4     0.752           0.869           TRUE</span></span></code></pre></div>
<p>Fit a basic model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">media_index</span> <span class="op">~</span> <span class="va">party_autonomy</span> <span class="op">+</span> <span class="va">civil_liberties</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_2015</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">Beta</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="posterior-predictions">Posterior predictions<a class="anchor" aria-label="anchor" href="#posterior-predictions"></a>
</h3>
<p>To compute posterior predictions for specific values of the
regressors, we use the <code>newdata</code> argument and the
<code>datagrid</code> function. We also use the <code>type</code>
argument to compute two types of predictions: accounting for residual
(observation-level) residual variance (<code>prediction</code>) or
ignoring it (<code>response</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>              party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>              civil_liberties <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>              region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"prediction"</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span><span class="op">)</span></span></code></pre></div>
<p>Extract posterior draws and plot them:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media index (predicted)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-21-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="marginal-effects-and-contrasts">Marginal effects and contrasts<a class="anchor" aria-label="anchor" href="#marginal-effects-and-contrasts"></a>
</h3>
<p>As noted in the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/slopes.html">Marginal
Effects vignette</a>, there should be one distinct marginal effect for
each combination of regressor values. Here, we consider only one
combination of regressor values, where <code>region</code> is “Middle
East and North Africa”, and <code>civil_liberties</code> is 0.5. Then,
we calculate the mean of the posterior distribution of marginal
effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                       newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>                                          region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mfx</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Term     Contrast Estimate  2.5 % 97.5 % civil_liberties                       region</span></span>
<span><span class="co">#&gt;   party_autonomy TRUE - FALSE   0.2517 0.1663 0.3356             0.5 Middle East and North Africa</span></span>
<span><span class="co">#&gt;  civil_liberties        dY/dX   0.8160 0.6214 1.0066             0.5 Middle East and North Africa</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo, media_index, party_autonomy, civil_liberties, region, eps</span></span></code></pre></div>
<p>Use the <code><a href="../reference/posterior_draws.html">posterior_draws()</a></code> to extract draws from the
posterior distribution of marginal effects, and plot them:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, y <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marginal effect"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-23-1.png" width="100%"></p>
<p>Plot marginal effects, conditional on a regressor:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>         effect <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>         condition <span class="op">=</span> <span class="st">"party_autonomy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-24-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="continuous-predictors">Continuous predictors<a class="anchor" aria-label="anchor" href="#continuous-predictors"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                       region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span>,</span>
<span>                                       civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">stat_lineribbon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Media index (predicted)"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-25-1.png" width="100%"></p>
<p>The slope of this line for different values of civil liberties can be
obtained with:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span></span>
<span>        civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.8</span><span class="op">)</span>,</span>
<span>        party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"civil_liberties"</span><span class="op">)</span></span>
<span><span class="va">mfx</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Term Estimate  2.5 % 97.5 % civil_liberties party_autonomy                       region</span></span>
<span><span class="co">#&gt;  civil_liberties   0.4900 0.3609 0.6388             0.2          FALSE Middle East and North Africa</span></span>
<span><span class="co">#&gt;  civil_liberties   0.8071 0.6122 0.9927             0.5          FALSE Middle East and North Africa</span></span>
<span><span class="co">#&gt;  civil_liberties   0.8069 0.6745 0.9337             0.8          FALSE Middle East and North Africa</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo, media_index, civil_liberties, party_autonomy, region, eps</span></span></code></pre></div>
<p>And plotted:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marginal effect of Civil Liberties on Media Index"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Civil liberties"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-27-1.png" width="100%"></p>
<p>The <code>slopes</code> function can use the ellipsis
(<code>...</code>) to push any argument forward to the
<code>posterior_predict</code> function. This can alter the types of
predictions returned. For example, <a href="https://cran.r-project.org/web/packages/brms/brms.pdf" class="external-link">the
<code>re_formula=NA</code> argument of the
<code>posterior_predict.brmsfit</code> method</a> will compute
marginaleffects <em>without</em> including any group-level effects:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span></span>
<span>        civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.8</span><span class="op">)</span>,</span>
<span>        party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>    re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marginal effect of Civil Liberties on Media Index"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Civil liberties"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-28-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="global-grand-mean">Global grand mean<a class="anchor" aria-label="anchor" href="#global-grand-mean"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    re_formula <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    re_formula <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"party_autonomy"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media index (Predicted)"</span>,</span>
<span>              y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>  <span class="op">+</span></span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Contrast: Party autonomy TRUE - FALSE"</span>,</span>
<span>              y <span class="op">=</span> <span class="st">""</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine plots using the `patchwork` package</span></span>
<span><span class="va">plot1</span> <span class="op">+</span> <span class="va">plot2</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-30-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="region-specific-predictions-and-contrasts">Region-specific predictions and contrasts<a class="anchor" aria-label="anchor" href="#region-specific-predictions-and-contrasts"></a>
</h3>
<p>Predicted media index by region and level of civil liberties:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span>,</span>
<span>                                       party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                       civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">stat_lineribbon</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">region</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Media index (predicted)"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-31-1.png" width="100%"></p>
<p>Predicted media index by region and level of civil liberties:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span>,</span>
<span>                                       civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.8</span><span class="op">)</span>,</span>
<span>                                      party_autonomy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">region</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media index (predicted)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Posterior density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Civil liberties"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-32-1.png" width="100%"></p>
<p>Predicted media index by region and party autonomy:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>                    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span>,</span>
<span>                                       party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                                       civil_liberties <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, y <span class="op">=</span> <span class="va">region</span> , fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media index (predicted)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">""</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-33-1.png" width="100%"></p>
<p>TRUE/FALSE contrasts (marginal effects) of party autonomy by
region:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"party_autonomy"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span></span>
<span>        region <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span>,</span>
<span>        civil_liberties <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, y <span class="op">=</span> <span class="va">region</span> , fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media index (predicted)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">""</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-34-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="hypothetical-groups">Hypothetical groups<a class="anchor" aria-label="anchor" href="#hypothetical-groups"></a>
</h3>
<p>We can also obtain predictions or marginal effects for a hypothetical
group instead of one of the observed regions. To achieve this, we create
a dataset with <code>NA</code> in the <code>region</code> column. Then
we call the <code>marginaleffects</code> or <code>predictions</code>
functions with the <code>allow_new_levels</code> argument. This argument
is pushed through via the ellipsis (<code>...</code>) to the
<code>posterior_epred</code> function of the <code>brms</code>
package:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>                  party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  region <span class="op">=</span> <span class="st">"New Region"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"party_autonomy"</span>,</span>
<span>    allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Marginal effect of party autonomy in a generic world region"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-35-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="averaging-marginalizing-integrating-random-effects">Averaging, marginalizing, integrating random effects<a class="anchor" aria-label="anchor" href="#averaging-marginalizing-integrating-random-effects"></a>
</h3>
<p>Consider a logistic regression model with random effects:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/plm/EmplUK.csv"</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">output</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">output</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">emp</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">emp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">firm</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span>, family <span class="op">=</span> <span class="st">"bernoulli"</span><span class="op">)</span></span></code></pre></div>
<p>We can compute adjusted predictions for a given value of
<code>x</code> and for each firm (random effects) as follows:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, firm <span class="op">=</span> <span class="va">unique</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Estimate     2.5 %   97.5 % x firm</span></span>
<span><span class="co">#&gt;  1.000e+00 9.012e-01 1.000000 0    1</span></span>
<span><span class="co">#&gt;  1.000e+00 8.947e-01 1.000000 0    2</span></span>
<span><span class="co">#&gt;  1.000e+00 9.121e-01 1.000000 0    3</span></span>
<span><span class="co">#&gt;  1.000e+00 7.971e-01 1.000000 0    4</span></span>
<span><span class="co">#&gt;  1.000e+00 9.090e-01 1.000000 0    5</span></span>
<span><span class="co">#&gt;  4.899e-08 8.418e-21 0.001898 0    6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, y, x, firm</span></span></code></pre></div>
<p>We can average/marginalize/integrate across random effects with the
<code><a href="../reference/predictions.html">avg_predictions()</a></code> function or the <code>by</code>
argument:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">avg_predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, firm <span class="op">=</span> <span class="va">unique</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    0.4539 0.4396 0.4683</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, firm <span class="op">=</span> <span class="va">unique</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  x Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  0   0.4539 0.4396 0.4683</span></span>
<span><span class="co">#&gt;  1   0.5572 0.5456 0.5696</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, x, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>We can also draw from the (assumed gaussian) population distribution
of random effects, by asking <code><a href="../reference/predictions.html">predictions()</a></code> to make
predictions for new “levels” of the random effects. If we then take an
average of predictions using <code><a href="../reference/predictions.html">avg_predictions()</a></code> or the
<code>by</code> argument, we will have <a href="https://joshuawiley.com/brmsmargins/articles/mixed-effects-slopes.html#integrating-out-random-effects" class="external-link">“integrated
out the random effects”, as described in the <code>brmsmargins</code>
package vignette.</a> In the code below, we make predictions for 100
firm identifiers which were not in the original dataset. We also ask
<code><a href="../reference/predictions.html">predictions()</a></code> to push forward the
<code>allow_new_levels</code> and <code>sample_new_levels</code>
arguments to the <code><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">brms::posterior_epred</a></code> function:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, firm <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>    allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sample_new_levels <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  x Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  0   0.4519 0.3436  0.567</span></span>
<span><span class="co">#&gt;  1   0.5524 0.4376  0.663</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, x, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>We can “integrate out” random effects in the other
<code>slopes</code> functions too. For instance,</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>firm <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>    allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sample_new_levels <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     x    1 - 0   0.0969 0.04778 0.1639</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>This is nearly equivalent the <code>brmsmargins</code> command output
(with slight variations due to different random seeds):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuawiley.com/brmsmargins/" class="external-link">brmsmargins</a></span><span class="op">)</span></span>
<span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://joshuawiley.com/brmsmargins/reference/brmsmargins.html" class="external-link">brmsmargins</a></span><span class="op">(</span></span>
<span>  k <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  object <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">.95</span>,</span>
<span>  CIType <span class="op">=</span> <span class="st">"ETI"</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"AME x"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  effects <span class="op">=</span> <span class="st">"integrateoutRE"</span><span class="op">)</span></span>
<span><span class="va">bm</span><span class="op">$</span><span class="va">ContrastSummary</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            M        Mdn        LL        UL PercentROPE PercentMID   CI CIType ROPE  MID Label</span></span>
<span><span class="co">#&gt; 1 0.09887903 0.09630984 0.0477415 0.1620762          NA         NA 0.95    ETI &lt;NA&gt; &lt;NA&gt; AME x</span></span></code></pre></div>
<p>See the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/alternative_software.html">alternative
software vignette</a> for more information on
<code>brmsmargins</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="multinomial-logit">Multinomial logit<a class="anchor" aria-label="anchor" href="#multinomial-logit"></a>
</h2>
<p>Fit a model with categorical outcome (heating system choice in
California houses) and logit link:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/Ecdat/Heating.csv"</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">depvar</span> <span class="op">~</span> <span class="va">ic.gc</span> <span class="op">+</span> <span class="va">oc.gc</span>,</span>
<span>           data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>           family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">categorical</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="adjusted-predictions-1">Adjusted predictions<a class="anchor" aria-label="anchor" href="#adjusted-predictions-1"></a>
</h3>
<p>Compute predicted probabilities for each level of the outcome
variable:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Group Estimate   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;     ec  0.06627 0.04472 0.09305</span></span>
<span><span class="co">#&gt;     ec  0.07682 0.05896 0.09740</span></span>
<span><span class="co">#&gt;     ec  0.10300 0.06181 0.15850</span></span>
<span><span class="co">#&gt;     ec  0.06335 0.04590 0.08379</span></span>
<span><span class="co">#&gt;     ec  0.07453 0.05740 0.09468</span></span>
<span><span class="co">#&gt;     ec  0.07086 0.04546 0.10360</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, group, estimate, conf.low, conf.high, depvar, ic.gc, oc.gc</span></span></code></pre></div>
<p>Extract posterior draws and plot them:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted probability"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>         fill <span class="op">=</span> <span class="st">"Heating system"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-46-1.png" width="100%"></p>
<p>Use the <code>plot_predictions</code> function to plot conditional
adjusted predictions for each level of the outcome variable
<code>gear</code>, conditional on the value of the <code>mpg</code>
regressor:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"oc.gc"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Predicted probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-47-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="marginal-effects-1">Marginal effects<a class="anchor" aria-label="anchor" href="#marginal-effects-1"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Group  Term Estimate   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;     ec ic.gc   4.3839   4.007   4.7376</span></span>
<span><span class="co">#&gt;     er ic.gc   0.0928  -0.270   0.4149</span></span>
<span><span class="co">#&gt;     gc ic.gc  -7.9963  -8.498  -7.4477</span></span>
<span><span class="co">#&gt;     ec oc.gc  19.3866  17.717  20.9493</span></span>
<span><span class="co">#&gt;     er oc.gc   0.4105  -1.194   1.8349</span></span>
<span><span class="co">#&gt;     gc oc.gc -35.3623 -37.581 -32.9363</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, group, term, estimate, conf.low, conf.high</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hurdle-models">Hurdle models<a class="anchor" aria-label="anchor" href="#hurdle-models"></a>
</h2>
<p>This section replicates some analyses from <a href="https://www.andrewheiss.com/blog/2022/05/09/hurdle-lognormal-gaussian-brms/#emmeans-with-hurdle-models" class="external-link">yet
another amazing blog post by Andrew Heiss.</a></p>
<p>To begin, we estimate a hurdle model in <code>brms</code> with random
effects, using data from the <code>gapminder</code> package: 704G</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder" class="external-link">gapminder</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cmdstanr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CHAINS</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">ITER</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">WARMUP</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">BAYES_SEED</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">gapminder</span><span class="fu">::</span><span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Make a bunch of GDP values 0</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prob_zero <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">&lt;</span> <span class="fl">50</span>, <span class="fl">0.3</span>, <span class="fl">0.02</span><span class="op">)</span>,</span>
<span>         will_be_zero <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prob_zero</span><span class="op">)</span>,</span>
<span>         gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">will_be_zero</span>, <span class="fl">0</span>, <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">prob_zero</span>, <span class="op">-</span><span class="va">will_be_zero</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Make a logged version of GDP per capita</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>log_gdpPercap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_zero <span class="op">=</span> <span class="va">gdpPercap</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">gdpPercap</span> <span class="op">~</span> <span class="va">lifeExp</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">lifeExp</span> <span class="op">+</span> <span class="va">year</span> <span class="op">|</span> <span class="va">continent</span><span class="op">)</span>,</span>
<span>     <span class="va">hu</span> <span class="op">~</span> <span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gapminder</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">hurdle_lognormal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  silent <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="adjusted-predictions-2">Adjusted predictions<a class="anchor" aria-label="anchor" href="#adjusted-predictions-2"></a>
</h3>
<p>Adjusted predictions for every observation in the original data:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     142.5 103.1  218.8</span></span>
<span><span class="co">#&gt;     168.3 124.9  255.8</span></span>
<span><span class="co">#&gt;     201.7 152.9  303.7</span></span>
<span><span class="co">#&gt;     251.5 196.6  372.8</span></span>
<span><span class="co">#&gt;     312.2 249.5  454.2</span></span>
<span><span class="co">#&gt;     397.5 324.6  566.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, gdpPercap, lifeExp, year, continent</span></span></code></pre></div>
<p>Adjusted predictions for the <code>hu</code> parameter:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, dpar <span class="op">=</span> <span class="st">"hu"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    0.5739 0.4747 0.6516</span></span>
<span><span class="co">#&gt;    0.5365 0.4416 0.6113</span></span>
<span><span class="co">#&gt;    0.4956 0.4069 0.5664</span></span>
<span><span class="co">#&gt;    0.4455 0.3656 0.5106</span></span>
<span><span class="co">#&gt;    0.3957 0.3252 0.4537</span></span>
<span><span class="co">#&gt;    0.3413 0.2824 0.3907</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, gdpPercap, lifeExp, year, continent</span></span></code></pre></div>
<p>Predictions on a different scale:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span>, dpar <span class="op">=</span> <span class="st">"hu"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;   0.29798 -0.1014  0.62593</span></span>
<span><span class="co">#&gt;   0.14627 -0.2347  0.45274</span></span>
<span><span class="co">#&gt;  -0.01776 -0.3767  0.26728</span></span>
<span><span class="co">#&gt;  -0.21885 -0.5510  0.04244</span></span>
<span><span class="co">#&gt;  -0.42336 -0.7301 -0.18572</span></span>
<span><span class="co">#&gt;  -0.65730 -0.9326 -0.44428</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: rowid, type, estimate, conf.low, conf.high, gdpPercap, lifeExp, year, continent</span></span></code></pre></div>
<p>Plot adjusted predictions as a function of <code>lifeExp</code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"lifeExp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    dpar <span class="op">=</span> <span class="st">"hu"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"lifeExp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"hu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-54-1.png" width="100%"></p>
<p>Predictions with more than one condition and the
<code>re_formula</code> argument from <code>brms</code>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    re_formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lifeExp"</span>, <span class="st">"continent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-55-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="extract-draws-with-posterior_draws">Extract draws with <code>posterior_draws()</code><a class="anchor" aria-label="anchor" href="#extract-draws-with-posterior_draws"></a>
</h3>
<p>The <code><a href="../reference/posterior_draws.html">posterior_draws()</a></code> function extract raw samples from
the posterior from objects produced by <code>marginaleffects</code>.
This allows us to use richer geoms and summaries, such as those in the
<code>ggdist</code> package:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    re_formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>                       continent <span class="op">=</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span>,</span>
<span>                       year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span><span class="op">)</span>,</span>
<span>                       lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">80</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lifeExp</span>, <span class="va">draw</span>, fill <span class="op">=</span> <span class="va">continent</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_lineribbon.html" class="external-link">stat_lineribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">year</span> <span class="op">~</span> <span class="va">continent</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-56-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="average-contrasts">Average Contrasts<a class="anchor" aria-label="anchor" href="#average-contrasts"></a>
</h3>
<p>What happens to <code>gdpPercap</code> when <code>lifeExp</code>
increases by one?</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Contrast Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp       +1   718.87 515.58 811.96</span></span>
<span><span class="co">#&gt;     year       +1   -63.82 -84.44 -41.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>What happens to <code>gdpPercap</code> when <code>lifeExp</code>
increases by one standard deviation?</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term                Contrast Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp (x + sd/2) - (x - sd/2)     4050  3718   4741</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>What happens to <code>gdpPercap</code> when <code>lifeExp</code>
increases from 50 to 60 and <code>year</code> simultaneously increases
its min to its max?</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span>, year <span class="op">=</span> <span class="st">"minmax"</span><span class="op">)</span>,</span>
<span>    cross <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  C: lifeExp   C: year Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min   1001.5 522.5   1330</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min   1001.5 522.5   1330</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min   1001.5 522.5   1330</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min   1001.5 522.5   1330</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min   1001.5 522.5   1330</span></span>
<span><span class="co">#&gt; --- 1670 rows omitted. See ?print.marginaleffects --- </span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min    466.9 112.6   1299</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min    466.9 112.6   1299</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min    466.9 112.6   1299</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min    466.9 112.6   1299</span></span>
<span><span class="co">#&gt;     60 - 50 Max - Min    466.9 112.6   1299 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast_lifeExp, contrast_year, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
<p>Plot draws from the posterior distribution of average contrasts
(<em>not</em> the same thing as draws from the posterior distribution of
contrasts):</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_dotsinterval.html" class="external-link">stat_dotsinterval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Posterior distribution of average contrasts"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-60-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="marginal-effects-slopes">Marginal effects (slopes)<a class="anchor" aria-label="anchor" href="#marginal-effects-slopes"></a>
</h3>
<p>Average Marginal Effect of <code>lifeExp</code> on different scales
and for different parameters:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp   718.71 515.56 811.70</span></span>
<span><span class="co">#&gt;     year   -63.82 -84.44 -41.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Estimate    2.5 %    97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp  0.08249  0.07419  0.088564</span></span>
<span><span class="co">#&gt;     year -0.00937 -0.01201 -0.006316</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, dpar <span class="op">=</span> <span class="st">"hu"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term  Estimate     2.5 %    97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp -0.008171 -0.009367 -0.006687</span></span>
<span><span class="co">#&gt;     year  0.000000  0.000000  0.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, dpar <span class="op">=</span> <span class="st">"hu"</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Term Estimate   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;  lifeExp -0.09934 -0.1132 -0.08382</span></span>
<span><span class="co">#&gt;     year  0.00000  0.0000  0.00000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>Plot Conditional Marginal Effects</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    effect <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"lifeExp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    dpar <span class="op">=</span> <span class="st">"hu"</span>,</span>
<span>    effect <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"lifeExp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"hu"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-62-1.png" width="100%"></p>
<p>Or we can call <code><a href="../reference/slopes.html">slopes()</a></code> or <code><a href="../reference/comparisons.html">comparisons()</a></code>
with <code><a href="../reference/posterior_draws.html">posterior_draws()</a></code> function to have even more
control:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"link"</span>,</span>
<span>    variables <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">70</span><span class="op">)</span>, continent <span class="op">=</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">draw</span>, <span class="va">continent</span>, fill <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_dotsinterval.html" class="external-link">stat_dotsinterval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Effect of a 1 unit change in Life Expectancy"</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-63-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="bayesian-estimates-and-credible-intervals">Bayesian estimates and credible intervals<a class="anchor" aria-label="anchor" href="#bayesian-estimates-and-credible-intervals"></a>
</h2>
<p>For bayesian models like those produced by the <code>brms</code> or
<code>rstanarm</code> packages, the <code>marginaleffects</code> package
functions report the median of the posterior distribution as their main
estimates.</p>
<p>The default credible intervals are equal-tailed intervals
(quantiles), and the default function to identify the center of the
distribution is the median. Users can customize the type of intervals
reported by setting global options. Note that both the reported estimate
and the intervals change slightly:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/insight/" class="external-link">insight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">insight</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/insight/reference/download_model.html" class="external-link">download_model</a></span><span class="op">(</span><span class="st">"brms_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>marginaleffects_posterior_interval <span class="op">=</span> <span class="st">"hdi"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>marginaleffects_posterior_center <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   cyl       +1   -1.500 -2.385 -0.6771</span></span>
<span><span class="co">#&gt;    wt       +1   -3.206 -4.704 -1.5704</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>marginaleffects_posterior_interval <span class="op">=</span> <span class="st">"eti"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>marginaleffects_posterior_center <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate  2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   cyl       +1   -1.494 -2.361 -0.6361</span></span>
<span><span class="co">#&gt;    wt       +1   -3.195 -4.792 -1.6450</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="random-variables-posterior-and-ggdist">Random variables: <code>posterior</code> and
<code>ggdist</code><a class="anchor" aria-label="anchor" href="#random-variables-posterior-and-ggdist"></a>
</h2>
<p>Recent versions of the <code>posterior</code>, <code>brms</code>, and
<code>ggdist</code> packages make it easy to draw, summarize and plot
random variables. The <code><a href="../reference/posterior_draws.html">posterior_draws()</a></code> can produce objects
of class <code>rvar</code> which make it easy to use those features by
returning a data frame with a column of type <code>rvar</code>:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"am"</span><span class="op">)</span></span>
<span><span class="va">rvar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span><span class="va">p</span>, shape <span class="op">=</span> <span class="st">"rvar"</span><span class="op">)</span> </span>
<span><span class="va">rvar</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  am Estimate 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   0    17.12 14.75  19.43</span></span>
<span><span class="co">#&gt;   1    24.34 21.58  26.97</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, am, estimate, conf.low, conf.high, rvar</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rvar</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">am</span>, xdist <span class="op">=</span> <span class="va">rvar</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slabinterval.html" class="external-link">stat_slabinterval</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="brms_files/figure-html/unnamed-chunk-66-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="non-linear-hypothesis-testing">Non-linear hypothesis testing<a class="anchor" aria-label="anchor" href="#non-linear-hypothesis-testing"></a>
</h2>
<p>We begin by estimating a model:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html" class="external-link">bernoulli</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           seed <span class="op">=</span> <span class="fl">1024</span>, silent <span class="op">=</span> <span class="fl">2</span>, chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Notice that we can compute average contrasts in two different ways,
using the <code><a href="../reference/comparisons.html">avg_comparisons()</a></code> function or the
<code>transform_pre</code> argument:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate    2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;    hp       +1 0.005987 0.002884 0.00886</span></span>
<span><span class="co">#&gt;   mpg       +1 0.135474 0.078713 0.17472</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, transform_pre <span class="op">=</span> <span class="st">"differenceavg"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate    2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   mpg mean(+1) 0.135474 0.078713 0.17472</span></span>
<span><span class="co">#&gt;    hp mean(+1) 0.005987 0.002884 0.00886</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
<p>Now, we use the <code>hypothesis</code> argument to compare the first
to the second rows of the <code><a href="../reference/comparisons.html">comparisons()</a></code> output:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">comparisons</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    transform_pre <span class="op">=</span> <span class="st">"differenceavg"</span>,</span>
<span>    hypothesis <span class="op">=</span> <span class="st">"b2 - b1 = 0.2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       Term Estimate   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;  b2-b1=0.2  -0.3298 -0.3666 -0.2748</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, conf.low, conf.high</span></span></code></pre></div>
<p>The <code>hypotheses</code> function of the <code>brms</code> package
can also perform non-linear hypothesis testing, and it generates some
convenient statistics and summaries. This function accepts a D-by-P
matrix of draws from the posterior distribution, where D is the number
of draws and N is the number of parameters. We can obtain such a matrix
using the <code>posterior_draws(x, shape = "DxP")</code>, and we can
simply add a couple calls to our chain of operations:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comparisons.html">avg_comparisons</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/posterior_draws.html">posterior_draws</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"DxP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="st">"b2 - b1 &gt; .2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Hypothesis Tests for class :</span></span>
<span><span class="co">#&gt;         Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star</span></span>
<span><span class="co">#&gt; 1 (b2-b1)-(.2) &gt; 0    -0.07      0.02    -0.12    -0.04          0         0     </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; 'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.</span></span>
<span><span class="co">#&gt; '*': For one-sided hypotheses, the posterior probability exceeds 95%;</span></span>
<span><span class="co">#&gt; for two-sided hypotheses, the value tested against lies outside the 95%-CI.</span></span>
<span><span class="co">#&gt; Posterior probabilities of point hypotheses assume equal prior probabilities.</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
